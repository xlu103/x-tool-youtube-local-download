<!DOCTYPE html>
<html>

<head>
    <title>YouTube 下载器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .header {
            text-align: center;
            padding: 40px 0;
            background: #f8f9fa;
            margin-bottom: 30px;
        }
        
        .download-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .video-info {
            margin-top: 10px;
        }
        
        .video-url {
            word-break: break-all;
            color: #666;
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .download-btn {
            margin-top: 10px;
        }
        
        .btn-redownload {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
        }
        
        .btn-redownload:hover {
            background-color: #218838;
            color: white;
        }
    </style>
</head>

<body>
    <div class="header">
        <div class="container">
            <h1>YouTube 视频下载器</h1>
            <p class="lead">输入YouTube视频链接,轻松下载高质量视频</p>
        </div>
    </div>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form action="/download" method="POST" class="mb-4">
                    <div class="input-group">
                        <input type="text" name="url" class="form-control" placeholder="请输入YouTube视频链接" required>
                        <button type="submit" class="btn btn-primary">
                            下载视频
                        </button>
                    </div>
                </form>

                <div id="download-result" class="alert" style="display: none;"></div>

                {% if downloads %}
                <h3 class="mb-4">下载记录</h3>
                {% for video in downloads %}
                <div class="download-item">
                    <h4>{{ video.title }}</h4>
                    <div class="video-url">
                        <strong>链接:</strong> <a href="{{ video.url }}" target="_blank">{{ video.url }}</a>
                    </div>
                    <div class="video-info">
                        <p><strong>作者:</strong> {{ video.author }}</p>
                        <p><strong>时长:</strong> {{ video.duration_human }}</p>
                        <p><strong>文件大小:</strong> {{ video.filesize_human }}</p>
                        <p><strong>下载时间:</strong> {{ video.download_time }}</p>
                        <p><strong>状态:</strong> {{ video.status }}</p>
                    </div>
                    <div class="download-btn">
                        <form action="/download" method="POST" style="display: inline;">
                            <input type="hidden" name="url" value="{{ video.url }}">
                            <button type="submit" class="btn btn-redownload">
                                重新下载
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %} {% endif %}
            </div>
        </div>
    </div>

    <script>
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/download', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('download-result');
                
                if (data.status === 'completed') {
                    // 显示批量下载结果
                    let message = `<h4>下载完成</h4>`;
                    if (data.successful.length > 0) {
                        message += `<p>成功下载 ${data.successful.length} 个视频</p>`;
                    }
                    if (data.failed.length > 0) {
                        message += `<p>失败 ${data.failed.length} 个视频</p>`;
                        message += `<details><summary>失败详情</summary><pre>${data.failed.join('\n')}</pre></details>`;
                    }
                    
                    resultDiv.className = 'alert alert-info';
                    resultDiv.innerHTML = message;
                    resultDiv.style.display = 'block';
                    
                    // 刷新下载列表
                    setTimeout(() => location.reload(), 3000);
                } else if (data.status === 'error') {
                    // 显示错误信息
                    resultDiv.className = 'alert alert-danger';
                    resultDiv.innerHTML = data.message;
                    resultDiv.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                const resultDiv = document.getElementById('download-result');
                resultDiv.className = 'alert alert-danger';
                resultDiv.innerHTML = '下载请求失败';
                resultDiv.style.display = 'block';
            });
        });
    </script>
</body>

</html>